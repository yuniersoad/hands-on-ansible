---

- hosts: webservers
  become: yes
  vars:
    doc_root: /var/www/html/ansible
    apache_conf_root: /etc/apache2

  tasks:
    - name: Install Apache
      apt: name=apache2 state=present

    - name: Start Apache
      service: name=apache2 state=started enabled=yes

    - name: Ensure dir exits
      file: path={{ doc_root }} state=directory

    - name: Copy Site Files
      template: src=templates/index.j2 dest={{ doc_root }}/index.html

    - name: Copy virtual host file
      template: src=templates/virtual_host.j2 dest={{ apache_conf_root }}/sites-available/000-default.conf
      notify: Restart Apache

    - name: Copy ports file
      template: src=templates/ports.j2 dest={{ apache_conf_root }}/ports.conf
      notify: Restart Apache

  handlers:
    - name: Restart Apache
      service: name=apache2 state=restarted

- hosts: dbservers
  become: yes
  tasks:
    - name: Install Mysql
      apt: name=mysql-server state=present

    - name: Start Mysql
      service: name=mysql state=started enabled=yes

